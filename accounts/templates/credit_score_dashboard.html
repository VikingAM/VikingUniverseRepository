{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Credit Score Dashboard</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'portal/css/navbar.css' %}">
	<!-- <link rel="stylesheet" href="{% static 'portal/css/style.css' %}"> -->
	<link rel="stylesheet" href="{% static 'account/css/credit_score.css' %}">
	<link rel="stylesheet" href="{% static 'fontawesome/css/all.css' %}">
</head>
<style type="text/css">
	@font-face {
        font-family: 'Integral';
        src:    url("{% static 'fonts/IntegralCF-DemiBold.woff2' %}") format('woff2'),
                url("{% static 'fonts/IntegralCF-DemiBold.woff' %}") format('woff'),
                url("{% static 'fonts/IntegralCF-DemiBold.eot' %}") format('eot'),
                url("{% static 'fonts/IntegralCF-DemiBold.otf' %}") format('otf');

    }

	
</style>
<body style="background:#F5F6FA;">
	<div class="row" id="body-row">
		{% include 'sidebar_v1.html' %}
		<div class="col p-4 main-container">
			<div class="container-fluid">
				<div class="row search_bar_wrapper">
					<div class="col-sm-10"></div>
	    			
	    			<div class="col-sm-2" style="text-align:right; margin: auto;">
	    				<i class="fas fa-fw fa-bell"></i> <span class="indicator"></span>
	    				<span>
	    					<img src="https://img.icons8.com/dusk/100/000000/user-female-circle.png" alt="" class="user-avatar-md rounded-circle" width="25px">
	    					{{ profile_details.first_name }} {{ profile_details.last_name }} 
	    					<i class="fa-solid fa-angle-down" style="cursor:pointer;"></i>
	    				</span>
	    				
	    			</div>
	    		</div><br/>
				<div class="row">
					<div class="col-sm-10">
						<h2 class="yourcreditScore">YOUR CREDIT</h2>
					</div>
					<div class="col-sm-2">
						<button class="add_more_credit_btn" data-toggle="modal" data-target="#AddMoreCredit">ADD MORE</button>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-12">
						<div class="row">
							<div class="col-sm-6 creditbox" >
								<div class="row">
									<div class="col-sm-12 creditboxLabel">
										Available Credit
									</div>
								</div>
								<div class="row">
									<div class="col-sm-12 center CreditAmounts">
										{{ AVC }}
									</div>
								</div>
								<div class="row">
									<div class="col-sm-12 center CreditAmountsSubText">
										Use your credits to request more task!
									</div>
								</div>
							</div>
							<div class="col-sm-6 creditbox">
								<div class="row">
									<div class="col-sm-12 creditboxLabel">
										Total Credits Used
									</div>
								</div>
								<div class="row">
									<div class="col-sm-12 center CreditAmounts">
										{{ TCU }}
									</div>
								</div>
								<div class="row">
									<div class="col-sm-12 center CreditAmountsSubText">
										Use your credits to request more task!
									</div>
								</div>
								
							</div>
						</div>
					</div>
				</div><br/><br/>
				<div class="row">
					<div class="col-sm-12 creditboxHistory">
						<div class="row">
							<div class="col-sm-12 creditboxHistoryLabel">
								Credits History
							</div>
						</div>
						<div class="row">
							<table class="table" style="margin: 2%">
								<thead>
								    <tr>
								    	<th scope="col" width="40%"  >Task Name</th>
								    	<th scope="col" width="20%" class="center"> Start Date</th>
								    	<th scope="col" width="20%" class="center">End Date</th>
								    	<th scope="col" width="20%" class="center">Credits</th>
								    </tr>
							  	</thead>
							  	<tbody>
							  		{% for history in history_list %}
							  			<tr>
								  			<td class="task_label">
								  				{{ history.title }}!<br/>
								  				<p>{{ history.desc }}</p>
								  			</td>
								  			<td class="credit_history_dates center">
								  				{{ history.create_date|date:'M d, Y' }}
								  			</td>
								  			<td class="credit_history_dates center">
								  				
								  			</td>
								  			{% if history.type == "0" %}
								  				<td class="credit_history_use center" style="color:green;">
									  				{{ history.credit }}
									  			</td>
								  			{% else %}
								  				<td class="credit_history_use center" style="color:red;">
									  				{{ history.credit }}
									  			</td>
								  			{% endif %}
								  			
								  		</tr>
							  		{% empty %}
							  			<tr>
								  			<td class="task_label">
								  				#####!<br/>
								  				<p>#####</p>
								  			</td>
								  			<td class="credit_history_dates center">
								  				00/00/0000
								  			</td>
								  			<td class="credit_history_dates center">
								  				00/00/0000
								  			</td>
								  			<td class="credit_history_use center">
								  				0
								  			</td>
								  		</tr>
							  		{% endfor %}
							  		
							  	</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<input type="hidden" name="userId" id="userId" value="{{ request.user.pk }}">
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<script src="{% static 'portal/js/portalnavbar.js' %}"></script>
</body>



<!-- models -->
<div class="modal fade" id="AddMoreCredit" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="AddMoreCreditLabel" aria-hidden="true">
  	<div class="modal-dialog">
    	<div class="modal-content">
	      	<div class="modal-body">
		        <div class="row">
		        	<div class="col-sm-10 buy_credit_header">
		        		Buy Credits
		        	</div>
		        	<div class="col-sm-2">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		      				<span aria-hidden="true">&times;</span>
		    			</button>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12  buy_credit_sub_header">
		        		Buy Credits to add more task
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 center buy_credit_text">
		        		How Many Credits You like to add?
		        	</div>
		        </div>
		        <br/>
		        <div class="row">
					<div class="col-sm-2"></div>
					<div class="col-sm-2 center buy_credit_default_amount" amountVal="500" onclick="ChooseAmount(this);">
						500
					</div>
					<div class="col-sm-1"></div>
					<div class="col-sm-2 center buy_credit_default_amount" amountVal="1500" onclick="ChooseAmount(this);">
						1500
					</div>
					<div class="col-sm-1"></div>
					<div class="col-sm-2 center buy_credit_default_amount" amountVal="5000" onclick="ChooseAmount(this);">
						5000
					</div>
					<div class="col-sm-2"></div>
				</div>
				<div class="row">
		        	<div class="col-sm-12 center buy_credit_text">
		        		or custom amount
		        	</div>
		        </div>
		        <br/>
		        <div class="row">
		        	<div class="col-sm-3"></div>
		        	<div class="col-sm-6">
		        		<input type="text" id="custom_amount" onkeyup="updateTotalAmount(this);" name="custom_amount" class="form-control" placeholder="Custom Amount">
		        	</div>
		        	<div class="col-sm-3"></div>
		        </div>
		        <br/>
		        <div class="row">
		        	<div class="col-sm-12 center buy_credit_text">
		        		1 Credit = 1$
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-3"></div>
		        	<div class="col-sm-6">
		        		<hr>
		        	</div>
		        	<div class="col-sm-3"></div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 center buy_credit_text">
		        		Total amount to pay
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 center buy_credit_text" id="total_amount_to_pay">
		        		$0
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-3"></div>
		        	<div class="col-sm-6">
		        		<hr>
		        	</div>
		        	<div class="col-sm-3"></div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-3"></div>
		        	<div class="col-sm-6 center">
		        		<button class="buy_credit_payment_btn" onclick="ProcessPayment();">Proceed to Payment</button>
		        	</div>
		        	<div class="col-sm-3"></div>
		        </div>
		        <br/>
	      	</div>
    	</div>
  	</div>
</div>

<div class="modal fade" id="PaymentMethodModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="PaymentMethodModalLabel" aria-hidden="true">
  	<div class="modal-dialog">
    	<div class="modal-content">
	      	<div class="modal-body">
		        <div class="row">
		        	<div class="col-sm-10 buy_credit_header">
		        		Payment
		        	</div>
		        	<div class="col-sm-2">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		      				<span aria-hidden="true">&times;</span>
		    			</button>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12  buy_credit_sub_header">
		        		Payment Method
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12">
		        		<hr>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12">
		        		<div class="form-group">
    						<label for="CardHolderName">Card Holder Name</label>
							<input type="text" class="form-control" id="CardHolderName" name="CardHolderName" style="border-radius: 10px;">
  						</div>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-6">
		        		<div class="form-group">
    						<label for="CardNumber">Card Number</label>
							<input type="text" class="form-control" id="CardNumber" name="CardNumber" style="border-radius: 10px;">
  						</div>
		        	</div>
		        	<div class="col-sm-3">
		        		<div class="form-group">
    						<label for="ExpDate">Exp Date</label>
							<input type="text" class="form-control" id="ExpDate" name="ExpDate"style="border-radius: 10px;">
  						</div>
		        	</div>
		        	<div class="col-sm-3">
		        		<div class="form-group">
    						<label for="CCV">CCV</label>
							<input type="text" class="form-control" id="CCV" name="CCV" style="border-radius: 10px;">
  						</div>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 buy_credit_text">
		        		<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">
  							<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
						</svg>Credit card payment may take up to 24h to proceed<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle-fill" viewBox="0 0 16 16">
 							 <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/>
						</svg>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 buy_credit_text">
		        		<div class="form-group form-check">
					    	<input type="checkbox" class="form-check-input" id="SaveCard">
					    	<label class="form-check-label" for="SaveCard">Save my payment details for future purchases</label>
					  	</div>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-12 buy_credit_text">
		        		Summary
		        	</div>
		        	<div class="col-sm-12">
		        		<hr>
		        	</div>
		        	<div class="col-sm-6 buy_credit_text" id="step2_credits">
		        		50 Credits
		        	</div>
		        	<div class="col-sm-6 buy_credit_text text_right" id="step2_SubTamount">
		        		$50
		        	</div>
		        	<div class="col-sm-12">
		        		<hr>
		        	</div>
		        	<div class="col-sm-6 buy_credit_text">
		        		Total
		        	</div>
		        	<div class="col-sm-6 buy_credit_text text_right" id="step2_Tamount">
		        		$50
		        	</div>
		        </div>
		        <br/>
		        <div class="row">
		        	<div class="col-sm-2"></div>
		        	<div class="col-sm-8 center">
		        		<a href="{% url 'creditScoreDashboard' %}"><button class="buy_credit_payment_btn" style="padding: 3% 20%;" onclick="ConfirmPaymentBtn();">Confirm you payment</button></a>
		        	</div>
		        	<div class="col-sm-2"></div>
		        </div>
		        <br/>
	      	</div>
    	</div>
  	</div>
</div>

<div class="modal fade" id="ConfirmPaymentModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="ConfirmPaymentModalLabel" aria-hidden="true">
  	<div class="modal-dialog">
    	<div class="modal-content">
	      	<div class="modal-body">
		        <div class="row">
		        	<div class="col-sm-10 buy_credit_header">
		        		
		        	</div>
		        	<div class="col-sm-2">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		      				<span aria-hidden="true">&times;</span>
		    			</button>
		        	</div>
		        </div>
		        
		        <div class="row">
		        	<div class="col-sm-12 center buy_credit_header">
		        		Add Credit Successful
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-2"></div>
		        	<div class="col-sm-8 center confirm_credit_text">
		        		Now you can have more task and exceed your limitation!
		        	</div>
		        	<div class="col-sm-2"></div>
		        </div>
		        <br/><br/>
		         <div class="row">
		        	<div class="col-sm-2"></div>
		        	<div class="col-sm-8 center confirm_credit_text">
		        		An Invoice Will be sent into your email account to track your purchase!
		        	</div>
		        	<div class="col-sm-2"></div>
		        </div>
		        <br/><br/><br/>
		        <div class="row">
		        	<div class="col-sm-2"></div>
		        	<div class="col-sm-8 center">
		        		<button class="buy_credit_payment_btn" onclick="BacktoDashboard();" style="padding: 3% 20%;">Back To Dashboard</button>
		        	</div>
		        	<div class="col-sm-2"></div>
		        </div>
		        <br/>
	      	</div>
    	</div>
  	</div>
</div>
<input type="hidden" name="userId" id="userId" value="{{ request.user.pk }}">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
	jQuery.noConflict();
	function ProcessPayment(){
		var custom_amount = $("#custom_amount").val();
		if($.isNumeric(custom_amount)){
			$("#AddMoreCredit").modal("hide");
			$("#PaymentMethodModal").modal("show");
			$("#step2_credits").empty();
			$("#step2_credits").append(custom_amount+" Credits");
			$("#step2_Tamount").empty();
			$("#step2_Tamount").append("$"+custom_amount);
			$("#step2_SubTamount").empty();
			$("#step2_SubTamount").append("$"+custom_amount);
		}else{
			alert("Please use a proper amount!");
		}
		
	}
	//add computation for credits
	function ConfirmPaymentBtn(){
		var custom_amount = $("#custom_amount").val(); 
		var userId = $("#userId").val();
		jQuery.ajax({
	        type: "POST",
	        url: "{% url 'creditScoreAdd' %}",
	        data: {
	        		"csrfmiddlewaretoken": '{{ csrf_token }}',
	        		"custom_amount": parseInt(custom_amount),
	        		"userId": userId,
	        		"credits": parseInt(custom_amount),
	    		},
	        async:true,
	        success: function (data) {
	        	if(data.status_code != 0){
	        		$("#PaymentMethodModal").modal("hide");
					$("#ConfirmPaymentModal").modal("show");
	        	}else{
	        		// show error msg
	        	}
	            
	            
	        },
	        error: function (e) {
	            // $("#error_msg").append("Error! please try again later.");
	        }
	    })
		
	}

	function ChooseAmount(that) {
		var choosenAmount = $(that).attr("amountVal");
		$("#custom_amount").val(choosenAmount);
		$("#total_amount_to_pay").empty();
		$("#total_amount_to_pay").append("$"+choosenAmount);
	}

	function updateTotalAmount(that){
		var totalAmountValue = $(that).val();
		if($.isNumeric(totalAmountValue)){
			$("#total_amount_to_pay").empty();
			$("#total_amount_to_pay").append("$"+totalAmountValue);
		}else{
			$("#total_amount_to_pay").empty();
			$("#total_amount_to_pay").append("$0");
		}
		
	}
</script>
</body>
</html>