{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credits Dashboard | Credits</title>
    <link rel="stylesheet" href="{% static 'portal/css/index.css' %}">
    <link rel="stylesheet" href="{% static 'portal/css/style_v1.css' %}">
    <link rel="stylesheet" href="{% static 'fontawesome/css/fontawesome_5_13.min.css' %}">
</head>
<body>
    <!-- Sidebar Panel -->
    <div class="overlay hidden" onclick="toggleOverlayCredit()" id="overlay_id"></div>
    <div class="flex">
        {% include 'sidebar.html' %}
        <div>
            <nav class="bg-whiteSmoke text-white flex absolute right-0 justify-between items-center ml-0 m-8 h-20 xl:h-12 z-0 px-10 xl:px-0 mt-0 bxl:mt-2 xxl:mt-3">
                <ul class="flex items-center text-sm  text-gray-600">
                    <li class="flex items-center justify-center">
                        <a class="fas fa-search text-lg" href="#"></a>
                        <form action="">
                            <div class="h-10 flex items-center space-x-5 w-52">
                                <input class="w-full bg-whiteSmoke text-black xl:py-1 xl:text-sm bxl:text-base font-Poppins xxl:text-lg outline-0 py-4 px-5 text-lg" type="text" placeholder="Search">
                            </div>
                        </form>
                    </li>
                </ul>
                <ul class="flex items-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-5">
                        <li>
                            <a class="fas fa-bell text-lg ml-6 " href="#"></a>
                        </li>
                        <div class="flex items-center justify-center">
                            <li>
                                <a href="#">
                                    <img src="../../assets/nav/dawg.jpg" class="object-scale-down h-10 w-20 rounded-full" > 
                                </a>
                            </li>
                            
                            <li class="text-lg xl:text-sm mxl:text-2base xxl:text-lg">
                                <p class="font-Poppins">John Doe</p>
                            </li>
                        </div>
                        
                        <li class="">
                            <a class="fas fa-chevron-down text-lg ml-3" href="#"></a>
                        </li>
                    </div>
                </ul>
                
            </nav>
        </div>

        <div class="mt-32 bxl:mt-20 xl:mt-16 ml-5 xl:ml-10 xxl:ml-10 xxl:mt-16 overflow-hidden w-full">
            <div class="flex justify-between overflow-auto">
                <h1 class="text-4xl xl:text-2xl bxl:text-2xl mxl:text-3xl xxl:text-3xl font-Poppins text-editProfile font-extrabold">Your Credit</h1>
                <a href="#" onclick="toggleAddCredit()" class="text-center justify-center items-center font-Lato mt-20 xl:mt-0 xxl:mt-10 p-2 xl:p-1 xxl:p-2 kxl:p-3 kxl:text-4xl txl:text-xl xl:text:sm w-32 rounded-lg text-lg xl:text-sm xl:w-40 mxl:w-48 mxl:text-base mxl:py-3 xl:mr-10 xxl:mr-20 text-white bg-gradient-to-r from-linearButton1 to-linearButton2 duration-500">ADD MORE</a>
            </div>
            <a href="customPlan.html">Create custom plan</a>
            <a href="managePlan.html">Manage custom plan</a>
            <div class="flex xl:w-210 mxl:w-full xxl:w-full xl:mt-6 xl:space-x-8 xxl:space-x-24 xl:ml-5 xxl:ml-0 items-center justify-center">
                <div class="flex flex-col xl:w-120 mxl:w-140 xl:h-44 bg-white border border-gray-300 rounded-xl hover:bg-gray-200 duration-300 p-2 mxl:p-4">
                    <div class="flex justify-start font-bold ">
                        <h1 id="" class="font-Poppins text-profCol xl:text-xl font-bold">Available Credit</h1>
                    </div>

                    <div class="mt-5">
                        <p class="text-3xl font-bold font-Poppins text-center">{{ AVC }}</p>
                        <p id="" class="font-Poppins text-center text-sm bxl:text-2base">Use your credits to request more task!</p>
                    </div>
                </div>
                <div class="flex flex-col xl:w-120 mxl:w-140 xl:h-44 bg-white border border-gray-300 rounded-xl hover:bg-gray-200 duration-300 p-2 mxl:p-4">
                    <div class="flex justify-start font-bold ">
                        <h1 id="" class="font-Poppins text-profCol xl:text-xl font-bold">Total Credits Used</h1>
                    </div>
                    <div class="mt-5">
                        <p class="text-3xl font-bold font-Poppins text-center">{{ TCU }}</p>
                        <p id="" class="font-Poppins text-center text-sm bxl:text-2base">Use your credits to request more task!</p>
                    </div>
                </div>
            </div>
            <div class="mt-32 xl:mt-4 ml-5 xxl:-ml-5 xxl:p-10 flex mxl:w-full xxl:w-full xl:mb-10">
                <div class="credit_body overflow-auto  xl:h-110 bg-white border border-gray-300 rounded-xl xl:p-3 xxl:p-8 mxl:mr-24">
                    <h1 class="text-4xl xl:text-2xl  font-bold font-Poppins text-profCol">Credits History</h1>
                    <table class="table-auto xl:mt-5 xl:w-192 mxl:w-220 xxl:w-full xl:mx-20 mxl:mx-5 xxl:mx-0 text-star">
                        <thead class="thead_bg">
                            <tr class="credit text-2base bxl:text-base xxl:text-lg font-thin text-black border-b-1 border-gray-300 mxl:w-120 w-full">
                                <th class="font-Poppins ">Task Name</th>
                                <th class="font-Poppins ">Start Date</th>
                                <th class="font-Poppins">End Date</th>
                                <th class="font-Poppins text-center">Credits Used</th>
                            </tr>
                        </thead>
                        <tbody class="credit text-2base  font-Lato ">
                            {% for history in history_list %}
                                <tr class="inv_tr xl:text-2base text-base">
                                    <td class="font-Lato font-semibold p-2">
                                        <p class="font-Poppins font-bold">{{ history.title }}!</p>
                                        <p class="font-Poppins text-sm text-gray-500">{{ history.desc }}</p>
                                    </td>
                                    <td class="font-Lato font-semibold">{{ history.create_date|date:'M d, Y' }}</td>
                                    <td class="font-Lato font-semibold">{{ history.create_date|date:'M d, Y' }}</td>
                                    <td class="font-Lato font-semibold" style="text-align:center">{{ history.credit }}</td>
                                </tr>
                            {% empty %}
                                <tr class="inv_tr xl:text-2base text-base">
                                    <td class="font-Lato font-semibold p-2">
                                        <p class="font-Poppins font-bold ">No Credits Added</p>
                                        <p class="font-Poppins text-sm text-gray-500"></p>
                                    </td>
                                    <td class="font-Lato font-semibold"></td>
                                    <td class="font-Lato font-semibold"></td>
                                    <td class="font-Lato font-semibold" style="text-align:center"></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>      
        </div>
    </div>
    <div id="popup-add-credit" class="popup bg-gray-50 xl:w-135 xl:h-110 flex-col fixed z-10 xl:p-6">
        <div class="flex justify-between">
            <h1 class="font-Poppins text-xl font-bold text-purple-900">Buy Credits</h1>
            <button onclick="toggleCancelAddCredit()" class="fa fa-times-circle text-purple-900 text-xl xl:-mt-10 " aria-hidden="true"></button>
        </div>
        <div class="xl:mt-2">
            <h2 class="font-Poppins text-base">Buy credits to add more task</h2>
        </div>
        <form action="#">
            <div class="flex flex-col items-center justify-center">
                <h3 class="xl:mb-2 text-gray-600">How many credits would you like to add?</h3>
                <div class="flex xl:space-x-3 ">
                    {% for product in products %}
                        <div>
                            <input  type="radio" id="option_{{ product.pk }}" name="choice" value="{{ product.pk }}" prod_amount="{{ product.price }}" onclick="selectSubscription(this)" class="hidden">
                            <label for="option_{{ product.pk }}" class="custom-element hover:bg-purple-500 hover:duration-500 font-Poppins text-sm font-semibold">{{ product.name }}</label>
                        </div>
                    {% empty %}

                    {% endfor %}
                </div>
                <div class="flex flex-col justify-center items-center border-t border-b border-gray-300 xl:w-52 xl:py-2">
                    <h3 class="text-base text-gray-500">Total amount to pay:</h3>
                    <h3 class="text-base text-gray-500 xl:mt-4" id="total_amount_to_pay">$0</h3>
                </div>
                <div class="flex xl:mt-5">
                    <!-- <button type="button" onclick="togglePaymentMethod()" class="text-center justify-center items-center font-Poppins mt-20 xl:mt-0 p-2 xl:p-1 kxl:p-3 kxl:text-4xl txl:text-xl xl:text:sm w-32 rounded-lg text-lg bxl:text-sm xl:text-xvs xl:w-40 xl:mr-10 text-white bg-gradient-to-r from-linearButton1 to-linearButton2 duration-500">Proceed to Payment</button> -->
                    <button type="button" onclick="proceedCheckout()" class="text-center justify-center items-center font-Poppins mt-20 xl:mt-0 p-2 xl:p-1 kxl:p-3 kxl:text-4xl txl:text-xl xl:text:sm w-32 rounded-lg text-lg bxl:text-sm xl:text-xvs xl:w-40 xl:mr-10 text-white bg-gradient-to-r from-linearButton1 to-linearButton2 duration-500">Proceed to Payment</button>
                    <button type="reset" id="credit-reset-btn" class="font-Poppins bxl:text-sm text-xvs" onclick="uncheck()">Reset</button>
                </div>
            </div>
        </form>
    </div>
    <div style="display: hidden;">
        <form id="checkoutFrom" method="post" action="{% url 'paymentCheckout' %}">
            <input type="hidden" id="product_id_form" name="product_id" value="0">
        </form>
    </div>

    <div id="popup-credit-add-success" class="popup flex fixed bg-gray-50 xl:w-135 xl:h-72 flex-col z-10 xl:p-6 overflow-hidden"> 
        <h1 class="text-2xl font-Poppins font-bold text-purple-800">Add Credits Successful!</h1>
        <h4 class="font-Poppins text-sm xxl:text-2base xl:mt-3 xl:mb-4">Now you can have more task and exceed your limitation!</h4>
        <h4 class="font-Poppins text-sm xxl:text-2base">An invoice will be sent into your email account to track your purchase.</h4>
        <div class=" flex items-center justify-center">
            <a href="credit.html" class="font-Poppins text-center mt-20 xl:mt-14 xxl:mt-20 p-2 xl:p-0 kxl:p-3 kxl:text-4xl txl:text-xl xl:text:sm w-full rounded-lg text-lg xl:text-sm xxl:text-2base xl:w-72 text-white bg-gradient-to-r from-linearButton1 to-linearButton2 transition-colors duration-500">Back to Dashboard</a>
        </div>
    </div>
    <script src="{% static 'portal/js/uploadImg.js' %}"></script>
    <script src="{% static 'portal/js/enableBtn.js' %}"></script>
    <script src="{% static 'portal/js/tableStng.js' %}"></script>
    <script type="text/javascript" src="{% static 'portal/js/jquery_3.7.0.js' %}"></script>
    <script type="text/javascript">
        function selectSubscription(that){
            var product_id = $(that).val();
            var product_price = $(that).attr("prod_amount");
            $("#product_id_form").val(product_id);
            $("#total_amount_to_pay").empty();
            $("#total_amount_to_pay").append("$"+product_price);
        }

        function proceedCheckout(){
            var product_id = $("#product_id_form").val();
            if(product_id != 0){
                $("#checkoutFrom").submit();
            }else{
                alert("Please select a plan!");
            }
        }

        function ProcessPayment(){
            var custom_amount = $("#custom_amount").val();
            if($.isNumeric(custom_amount)){
                $("#AddMoreCredit").modal("hide");
                $("#PaymentMethodModal").modal("show");
                $("#step2_credits").empty();
                $("#step2_credits").append(custom_amount+" Credits");
                $("#step2_Tamount").empty();
                $("#step2_Tamount").append("$"+custom_amount);
                $("#step2_SubTamount").empty();
                $("#step2_SubTamount").append("$"+custom_amount);
            }else{
                alert("Please use a proper amount!");
            }
        }
        //add computation for credits
        function ConfirmPaymentBtn(){
            var custom_amount = $("#custom_amount").val(); 
            var userId = $("#userId").val();
            jQuery.ajax({
                type: "POST",
                url: "{% url 'creditScoreAdd' %}",
                data: {
                        "csrfmiddlewaretoken": '{{ csrf_token }}',
                        "custom_amount": parseInt(custom_amount),
                        "userId": userId,
                        "credits": parseInt(custom_amount),
                    },
                async:true,
                success: function (data) {
                    if(data.status_code != 0){
                        $("#PaymentMethodModal").modal("hide");
                        $("#ConfirmPaymentModal").modal("show");
                    }else{
                        // show error msg
                    }
                    
                    
                },
                error: function (e) {
                    // $("#error_msg").append("Error! please try again later.");
                }
            })
            
        }

        function ChooseAmount(that) {
            var choosenAmount = $(that).attr("amountVal");
            $("#custom_amount").val(choosenAmount);
            $("#total_amount_to_pay").empty();
            $("#total_amount_to_pay").append("$"+choosenAmount);
        }

        function updateTotalAmount(that){
            var totalAmountValue = $(that).val();
            if($.isNumeric(totalAmountValue)){
                $("#total_amount_to_pay").empty();
                $("#total_amount_to_pay").append("$"+totalAmountValue);
            }else{
                $("#total_amount_to_pay").empty();
                $("#total_amount_to_pay").append("$0");
            }
            
        }
    </script>
</body>
</html>