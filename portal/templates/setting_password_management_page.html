{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Password Management</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="{% static 'portal/css/index.css' %}">
    <link rel="stylesheet" href="{% static 'portal/css/style_v1.css' %}">
    <link rel="stylesheet" href="{% static 'tailwinds/output.css' %}">

    <link rel="stylesheet" href="{% static 'fontawesome/css/fontawesome_5_13.min.css' %}">
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    

	
</head>
<body>
	<div class="overlay hidden" onclick="toggleOverlayPwMngr()" id="overlay_id"></div>
    <div class="flex">  
        {% include 'sidebar.html' %}
        <!-- Settings Sidebar -->
        <div class="flex">
            <nav class="w-52 xl:ml-0 xl:w-44 bxl:w-52 xl_4k:w-120 h-auto ml-22 bg-gray-200 flex justify-center text-lg">
                <ul>
                    <li>
                        <center><p href="#" class="text-2xl bxl:text-xl bxl:mt-12 xl:text-lg xl_4k:text-6xl xl_4k:mt-32 mt-5 font-Lato font-bold">Settings</p></center> 
                    </li>
                    <div class="mt-20 xl_4k:mt-44 flex-row space-y-8 xl_4k:space-y-28 xl:text-2base">
                        <li>
                            <span class="fas fa-pencil-alt mr-2 xl_4k:text-4xl text-transparent bg-clip-text bg-gradient-to-r from-textGrad1 to-textGrad2 bxl:text-base"></span>
                            <a href="{% url 'portalSettingPage' %}" class="bxl:text-base xl_4k:text-4xl font-Lato text-transparent bg-clip-text bg-gradient-to-r from-textGrad1 to-textGrad2">Edit Profile</a>  
                        </li>
                        <li>
                            <span class="fas fa-lock mr-2 bxl:text-base xl_4k:text-4xl"></span>
                            <a href="{% url 'SettingPasswordPage' %}" class="font-Lato bxl:text-base xl_4k:text-4xl">Password</a>    
                        </li>
                        <li>
                            <span class="fas fa-file-invoice-dollar mr-3 bxl:text-base xl_4k:text-4xl"></span>
                            <a href="{% url 'SettingInvoicePage' %}" class="font-Lato bxl:text-base xl_4k:text-4xl">Invoices</a>    
                        </li>
                        <li>
                            <span class="fas fa-key mr-1 bxl:text-base xl_4k:text-4xl"></span>
                            <a href="{% url 'SettingPasswordManagementPage' %}" class="font-Lato bxl:text-base xl_4k:text-4xl">Password Manager</a>    
                        </li>
                        <li>
                            <span class="fas fa-question-circle mr-1 bxl:text-base xl_4k:text-4xl"></span>
                            <a href="{% url 'SettingFaqsPage' %}" class="font-Lato bxl:text-base xl_4k:text-4xl">FAQs</a>    
                        </li>
                    </div>
                </ul>
            </nav>
        </div>
        <div class="">
            <nav class="bg-whiteSmoke text-white flex absolute right-0 justify-between items-center ml-0 m-8 h-20 xl:h-12 z-0 px-10 xl:px-0 mt-0 bxl:mt-2 xxl:mt-3 xl_4k:mt-12 xl_4k:px-12">
                <ul class="flex items-center text-sm  text-gray-600">
                    <li class="flex items-center justify-center">
                        <a class="fas fa-search text-lg xl_4k:text-5xl" href="#"></a>
                        <form action="">
                            <div class="h-10 flex items-center space-x-5 w-52 xl_4k:w-80">
                                <input class="w-full font-Poppins bxl:text-base bg-whiteSmoke text-black xl:py-1 xl:text-sm xxl:text-lg outline-0 py-4 px-5 text-lg xl_4k:text-4xl" type="text" placeholder="Search">
                            </div>
                        </form>
                    </li>
                </ul>
                <ul class="flex items-center text-sm text-gray-600">
                    <div class="flex items-center justify-center space-x-5 xl_4k:space-x-20">
                        <li>
                            <a class="fas fa-bell text-lg ml-6  xl_4k:text-5xl" href="#"></a>
                        </li>
                        <div class="flex items-center justify-center">
                            <li>
                                <a href="#">
                                    <img src="https://img.icons8.com/dusk/100/000000/user-female-circle.png" class="object-scale-down h-10 w-20 rounded-full"> 
                                </a>
                            </li>
                            
                            <li class="text-lg xl:text-sm xxl:text-lg">
                                <p class="font-Jost xl_4k:text-5xl">{{ profile_details.first_name }} {{ profile_details.last_name }}</p>
                            </li>
                        </div>
                        <li class="">
                            <a class="fas fa-chevron-down text-lg xl_4k:text-4xl ml-3" href="#"></a>
                        </li>
                    </div>
                </ul>
            </nav>
        </div>

        <div class="mt-32 xl:mt-10 ml-5 xxl:mt-32 bxl:mt-16 xl_4k:mt-72 xl_4k:ml-40 overflow-hidden">
            <div>
                <h1 class="text-4xl xl:text-2xl font-bold font-Poppins text-editProfile xl_4k:text-7xl"><b>Your Passwords</b></h1>
                <div class="flex xl:space-x-4  xl:mt-2">
                    <a class="text-center font-Poppins xl:p-1 rounded-lg cursor-pointer bxl:text-2base xl:text-xsm xl_4k:text-4xl xl_4k:w-60 xl:w-20 bxl:w-25 text-white bg-gradient-to-r from-linearButton1 via-linearButton2 to-purple-500">
                        <i class="fas fa-plus xl:mr-1 xl_4k:text-4xl" data-bs-toggle="modal" data-bs-target="#add_new_password" ></i>Add New</a>
                        <!-- <button class="add_new_password_btn" >+ Add new</button> -->
                    <a class="text-center cursor-pointer font-Poppins text-xvs bxl:text-2base border-1 border-gray-800 xl:p-1 xl_4k:text-4xl xl_4k:w-60  rounded-lg xl:w-20">
                        <i class="fas fa-share xl:mr-1 xl_4k:text-4xl"></i>Share</a>
               </div>
            </div>
            <div class="w-full xxl:ml-52 xxl:mt-10">
                <div class="xl:h-105 overflow-y-auto">
                    <table class="xl:mt-5 xl:w-200 bxl:ml-14 xl_4k:mt-20 xl_4k:w-500 xl_4k:ml-0">
                        <thead class="xl:h-8">
                            <tr class="text-sm xl_4k:text-4xl xl_4k:w-full text-gray-500">
                                <th class="font-Poppins text-start xl_4k:p-6">Name</th>
                                <th class="font-Poppins">Category</th>
                                <th class="font-Poppins">Last Used</th>
                                <th class="font-Poppins ">
                                    <div>
                                        <li onclick="openNavSettings()" id="closeNav" class="cursor-pointer fas fa-sort-amount-up-alt text-lg xl_4k:text-4xl"> </li>
                                        <ul id="navSettings" class="hidden bg-white absolute border-1 rounded-xl shadow-lg border-gray-500 xl:p-2 xl_4k:right-80 xl_4k:w-64 xl_4k:top-160 xl:right-16 xl:top-44">
                                            <p class="font-Poppins text-start text-sm text-purple-900 xl_4k:text-3xl">Sort by</p>
                                            <li><a  href="#" class="font-Poppins xl:text-sm hover:bg-gray-300 duration-300 xl:pr-10 xl_4k:text-2xl">Account</a></li>
                                            <li><a  href="#" class="font-Poppins xl:text-sm hover:bg-gray-300 duration-300 xl:pr-10 xl_4k:text-2xl">Settings</a></li>
                                            <li><a  href="#" class="font-Poppins xl:text-sm hover:bg-gray-300 duration-300 xl:pr-10 xl_4k:text-2xl">Logout</a></li>
                                        </ul>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="text-2base text-invCol font-Lato xl_4k:text-3xl">
                            {% for profile_password in profile_passwords %}
                                <tr class="font-Lato w-20 xl:space-x-2">
                                    <td  class="font-Lato font-semibold">
                                        <!-- if facebook -->
                                        <div class="flex items-center justify-start xl:space-x-3"> 
                                            <div class="text-start">
                                                <i class="fab fa-facebook-f xl:text-xl"></i>
                                            </div>
                                            <div>
                                                <p class="font-Poppins  text-start font-semibold text-sm">facebook.com</p>
                                                <p class="font-Poppins text-start text-sm text-gray-500">{{ profile_password.name }}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td  class="font-Lato font-semibold">{{ profile_password.category.name }}</td>
                                    <td  class="font-Lato font-semibold">{{ profile_password.create_date | timesince }} Ago</td>
                                    <td class="font-Lato font-semibold" ><button class="fas fa-pencil-alt" attr_id="{{ profile_password.pk }}" onclick="editPasswordManagement(this)"></button></td>
                                </tr>
                            {% empty %}
                                <tr class="inv_tr border-b-1 border-gray-300">
                                    <td colspan="4" class="font-Poppins w-20 xl:space-x-2 xl_4k:text-4xl">No Saved Passwords</td>
                                </tr>
                            {% endfor%}   
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div id="popup-pw-mngr" class="popup bg-gray-50 xl:w-110 xl:h-150 absolute z-10 xl:p-6">
        <div class="flex justify-between">
            <h1 class="font-Poppins text-xl font-bold text-purple-900">Edit Password</h1>
            <button onclick="toggleCloseEditPw()" class="fa fa-times-circle text-purple-900 text-xl xl:-mt-10 " aria-hidden="true"></button>
        </div>
        <div>
            <table class=" xl:mt-5 ">
                <tbody class="inv_popup   text-2base font-Lato w-full">
                    <tr class="flex flex-col xl:px-5 xl:space-y-6 ">
                        <td class="xl:space-x-14">
                            <div class="alert alert-secondary" id="edit_password_error" style="display:none;" role="alert"></div>
                            <div class="alert alert-info" id="edit_password_info_msg" style="display:none;" role="alert"></div>
                            <div class="alert alert-success" id="edit_password_success_msg" style="display:none;" role="alert"></div>
                        </td>
                        <td class="xl:space-x-14">
                            <label class="font-Lato font-semibold">Name</label>
                            <input type="text" id="edit_password_name" nmae="edit_password_name" class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600">
                        </td>

                        <td class="xl:space-x-8">
                            <label class="font-Lato font-semibold">Category</label>
                            <!-- <input type="text" class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600"> -->
                            <select class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600" id="edit_password_category">
                                <option value=0>Select Category</option>
                                {% for category in password_category %}
                                    <option value='{{ category.pk}}'>{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </td>

                        <td class="xl:space-x-7">
                            <label class="font-Lato font-semibold">Username</label>
                            <input type="text" id="edit_password_username" name="edit_password_username" class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600">
                        </td> 

                        <td class="xl:space-x-8">
                            <label class="font-Lato font-semibold ">Password</label>
                            <input type="password" name="edit_password_management" id="edit_password_management" class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600">
                            <input type="checkbox" onclick="showPassword()">Show Password
                        </td>   

                        <td class="xl:space-x-16">
                            <label class="font-Lato font-semibold">URL</label>
                            <input type="text" name="edit_password_url" id="edit_password_url" class="font-Poppins xl:text-xsm xl:w-44 border border-b-gray-600">
                        </td>

                        <td class="xl:space-x-5">
                            <label class="font-Lato font-semibold">Description</label>
                            <input type="text" name="edit_password_description" id="edit_password_description" class="font-Poppins xl:text-xsm xl:w-60 xl:h-10 border border-b-gray-600">
                        </td>
                    </tr>
                    <input type="hidden" name="edit_password_management_id" id="edit_password_management_id" value="0">
                </tbody>
            </table> 
        </div>
        <button type="button" class="text-center font-Poppins xl:p-1 rounded-lg  cursor-pointer xl:mt-5 xl:text-xsm xl:w-20  text-white bg-gradient-to-r from-linearButton1 via-linearButton2 to-purple-500" onclick="UpdatePasswordManagement()">Save</button>
    </div>
<div class="modal fade" id="add_new_password" tabindex="-1" aria-labelledby="add_new_passwordLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="add_new_passwordLabel">Add new</h5>
                </div>
                <div class="modal-body">
                    <form id="add_new_password_form">
                        <div class="alert alert-secondary" id="new_password_error" style="display:none;" role="alert"></div>
                        <div class="alert alert-info" id="new_password_info_msg" style="display:none;" role="alert"></div>
                        <div class="alert alert-success" id="new_password_success_msg" style="display:none;" role="alert"></div>
                        <div class="form-group row">
                            <label for="forcategory" class="col-sm-4 col-form-label text-right" >Category</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="password_category">
                                    <option value=0>Select Category</option>
                                    {% for category in password_category %}
                                        <option value='{{ category.pk}}'>{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="forpasswordname" class="col-sm-4 col-form-label text-right" >Name*</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="password_name" id="password_name" value="" placeholder="name">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="forpasswordusername" class="col-sm-4 col-form-label text-right">Username/Email*</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="password_username" id="password_username" value="" placeholder="username/email">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="forPassword" class="col-sm-4 col-form-label text-right">Password*</label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" name="new_password_management" id="new_password_management" value="" placeholder="Password">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="forPassword" class="col-sm-4 col-form-label text-right">URL*</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="password_url" id="password_url" value="" placeholder="login url">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="forPassword" class="col-sm-4 col-form-label text-right">Description</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="new_password_description" id="new_password_description" value="" placeholder="Description">
                            </div>
                        </div>
                        <input type="hidden" name="edit_password_management_id" id="edit_password_management_id">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="saveNewPassword()">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'portal/js/uploadImg.js' %}"></script>
    <script src="{% static 'portal/js/enableBtn.js' %}"></script>
    <!-- just remove this when you are not using modal -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <!-- just remove this when you are not using modal -->
    <script type="text/javascript" src="{% static 'portal/js/jquery_3.7.0.js' %}"></script>
    <!-- return when finish on the deisgn flow. -->
	<script type="text/javascript">
		function saveNewPassword(){
			var name = $("#password_name").val();
			var category = $("#password_category").val();
			var username =  $("#password_username").val();
			var password = $("#new_password_management").val();
			var url = $("#password_url").val();
			var description = $("#new_password_description").val();

			$("#new_password_error").empty();
			$("#new_password_error").hide();
			if(inputCheckIfNotEmpty("password_name", "Password Name", "new_password_error") != true){ return false; }
			if(inputCheckIfNotEmpty("password_username", "Username / Email", "new_password_error") != true){ return false;}
			if(inputCheckIfNotEmpty("new_password_management", "Password", "new_password_error") != true){ return false;}
			if(inputCheckIfNotEmpty("password_url", "Url", "new_password_error") != true){return false;}
			$("#new_password_info_msg").show();
			$("#new_password_info_msg").append("Process request. . .");
			dataVal = {
				"csrfmiddlewaretoken": '{{ csrf_token }}',
		        "userId": '{{ request.user.id }}',
		        "category": category,
		        "password_name":name ,
		        "username": username,
		        "password": password,
		        "url": url,
		        "description": description,
			}
			$.ajax({
		        type: "POST",
		        url: "{% url 'profileNewPassword' %}",
		        data: dataVal,
		        async:true,
		        success: function (data) {
		        	$("#new_password_info_msg").hide();
		            if(data.status == 1){
		            	$("#new_password_success_msg").show();
		            	$("#new_password_success_msg").append(data.success_msg);
		            	location.reload(true);
		            }else{
		            	$("#new_password_error").append(data.error_msg);
		            	$("#new_password_error").show();
		            }
		        },
		        error: function (e) {
		            $("#new_password_error").append("Error! please try again later.");
		        }
		    })
		}

		function UpdatePasswordManagement(){
			$("#edit_password_info_msg").empty();
			$("#edit_password_info_msg").append("Updating . . .");
			$("#edit_password_info_msg").show();
			$("#edit_password_error").hide();
			$("#edit_password_success_msg").hide();
			var password_management_id = $("#edit_password_management_id").val();
			var password_name = $("#edit_password_name").val();
			var password_username = $("#edit_password_username").val();
			var password_management_password = $("#edit_password_management").val();
			var password_url = $("#edit_password_url").val();
			var password_description = $("#edit_password_description").val();
			var password_category = $("#edit_password_category").val();
			$.ajax({
		        type: "POST",
		        url: "{% url 'ProfileUpdatePassword' %}",
		        data: {
		        	"csrfmiddlewaretoken": '{{ csrf_token }}',
		        	"password_management_id":password_management_id,
		        	"name": password_name,
		        	"username": password_username,
		        	"password":password_management_password,
		        	"url":password_url,
		        	"description":password_description,
		        	"category": password_category,
		        },
		        async:true,
		        success: function (data) {
		        	$("#edit_password_info_msg").hide();
		        	if(data.status_code == 1){
		        		$("#edit_password_success_msg").empty();
		        		$("#edit_password_success_msg").append(data.status_msg);
		        		$("#edit_password_success_msg").show();
		        		$("#edit_password_success_msg").hide(2000);
                        location.reload(true);
		        	}else{
		        		$("#edit_password_error").empty();
		        		$("#edit_password_error").append(data.status_msg);
		        		$("#edit_password_error").show();
		        		$("#edit_password_error").hide(2000);
		        	}
		        },
		        error: function (e) {
		        	$("#edit_password_info_msg").hide();
		            $("#edit_password_error").empty();
		    		$("#edit_password_error").append("Error on updating!");
		    		$("#edit_password_error").show();
		    		$("#edit_password_error").hide(2000);
		        }
		    })
		}

		function inputCheckIfNotEmpty(field_id, field_name, error_holder_field_name){
			var value = $("#"+field_id).val();
			if(value.length == 0){
				$("#"+field_id).focus();
				$("#"+error_holder_field_name).append(field_name+" Should not be empty!")
				$("#"+error_holder_field_name).show();
				return false;
			}else{
				return true;
			}
		}

		function editPasswordManagement(that){
			// clear form
			$("#edit_password_management_id").val(0);
			$("#edit_password_name").val("");
			$("#edit_password_username").val("");
			$("#edit_password_management").val("");
			$("#edit_password_url").val("");
			$("#edit_password_description").val("");
			$("#edit_password_category").val(0);
			var password_management_id = $(that).attr("attr_id");
			$("#edit_password_info_msg").empty();
			$("#edit_password_info_msg").append("Fetching data . . .");
			$("#edit_password_info_msg").show();

            togglePwMngr()
			$.ajax({
		        type: "POST",
		        url: "{% url 'ProfileNewPasswordGetById' %}",
		        data: {
		        	"csrfmiddlewaretoken": '{{ csrf_token }}',
		        	"password_management_id":password_management_id,
		        },
		        async:true,
		        success: function (data) {
		        	$("#edit_password_info_msg").hide();
		        	$("#edit_password_name").val(data.name);
		        	$("#edit_password_username").val(data.username)
		        	$("#edit_password_management").val(data.password)
		        	$("#edit_password_url").val(data.url)
		        	$("#edit_password_description").val(data.description)
		        	$("#edit_password_management_id").val(password_management_id)
		        	$("#edit_password_category").val(data.category)
		        	$("#edit_password_info_msg").hide();
		        },
		        error: function (e) {
		        	$("#edit_password_info_msg").hide();
		            $("#edit_password_error").empty();
		    		$("#edit_password_error").append("Error on Fetching!");
		    		$("#edit_password_error").show();
		        }
		    })
		}

        function showPassword() { 
            var x = document.getElementById("edit_password_management");
            if (x.type === "password") {
                x.type = "text";
            } else {
                x.type = "password";
            }
        }
        
	</script>
</body>
</html>