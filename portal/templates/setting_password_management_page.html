{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Password Management</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'portal/css/navbar.css' %}">
	<link rel="stylesheet" href="{% static 'portal/css/profile.css' %}">
	<link rel="stylesheet" href="{% static 'fontawesome/css/all.css' %}">

	<style type="text/css">
		.add_new_password_btn{
			background: linear-gradient(90.97deg, rgba(26, 47, 238, 0.85) 0%, rgba(196, 26, 238, 0.85) 99.67%);
			border-radius: 10px;
			font-family: 'Poppins';
			font-style: normal;
			font-weight: 500;
			font-size: 15px;
			line-height: 22px;	
			color: #FFFFFF;
		}
		.share_password_management_btn{
			border: 1px solid #1B47EA;
			border-radius: 10px;
			font-family: 'Poppins';
			font-style: normal;
			font-weight: 500;
			font-size: 15px;
			line-height: 22px;
			color: #2030B9;
		}
	</style>
</head>
<body style="background:#F5F6FA;">
	<div class="row" id="body-row">
		{% include 'sidebar_v1.html' %}
		<div class="col main-container" style="padding-left: 0px;">
			<div class="row">
				{% include 'setting_sub_menu.html' %}
				<div class="col main-container">
					<div class="container-fluid">
						<br/>
						<div class="row search_bar_wrapper">
    						<div class="col-sm-10"></div>
							<div class="col-sm-2" style="text-align:right; margin: auto;">
								<i class="fas fa-fw fa-bell"></i> <span class="indicator"></span>
								<span>
									<img src="https://img.icons8.com/dusk/100/000000/user-female-circle.png" alt="" class="user-avatar-md rounded-circle" width="25px">
									{{ profile_details.first_name }} {{ profile_details.last_name }}
			    					<span class="dropdown">
										<span class="fa-solid fa-angle-down" type="button" id="Account-menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
										<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Account-menu">
											<button class="dropdown-item" type="button">Account</button>
										    <button class="dropdown-item" type="button">Settings</button>
										    <button class="dropdown-item" type="button">Logout</button>
										</div>
									</span>
								</span>
							</div>
    					</div>
    					<div class="row">
							<div class="col-sm-12">
								<span class="edit_profile_text">Your Passwords</span>
							</div>
							<div class="col-sm-4">
								<button class="add_new_password_btn" data-bs-toggle="modal" data-bs-target="#add_new_password">+ Add new</button>
								<button class="share_password_management_btn">Share</button>
							</div>
							<div class="col-sm-8"></div>
						</div><br/><br/>
						<div class="row">
							<table class="table">
								<thead>
									<th>Name</th>
									<th>Category</th>
									<th>Last Used</th>
									<th>filter</th>
								</thead>
								<tbody>
									{% for profile_password in profile_passwords %}
										<tr>
											<td>{{ profile_password.name }}</td>
											<td>No Category</td>
											<td>dunno</td>
											<td><button class="form-control" data-bs-toggle="modal" data-bs-target="#add_edit_password" attr_id="{{ profile_password.pk }}" onclick="editPasswordManagement(this)">Edit</button></td>
										</tr>
									{% empty %}
										<tr>
											<td colspan="4">No Save passwords</td>
										</tr>
									{% endfor%}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="add_new_password" tabindex="-1" aria-labelledby="add_new_passwordLabel" aria-hidden="true">
	  	<div class="modal-dialog">
	    	<div class="modal-content">
	      		<div class="modal-header">
	        		<h5 class="modal-title" id="add_new_passwordLabel">Add new</h5>
	      		</div>
	      		<div class="modal-body">
	        		<form id="add_new_password_form">
	        			<div class="alert alert-secondary" id="new_password_error" style="display:none;" role="alert"></div>
	        			<div class="alert alert-info" id="new_password_info_msg" style="display:none;" role="alert"></div>
	        			<div class="alert alert-success" id="new_password_success_msg" style="display:none;" role="alert"></div>
	        			<div class="form-group row">
	   						<label for="forcategory" class="col-sm-4 col-form-label text-right" >Category</label>
	    					<div class="col-sm-8">
	    						<select class="form-control" id="password_category">
	    							<option value=0>Select Category</option>
	    							{% for category in password_category %}
	    								<option value='{{ category.pk}}'>{{ category.name }}</option>
	    							{% endfor %}
	    						</select>
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forpasswordname" class="col-sm-4 col-form-label text-right" >Name*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="password_name" id="password_name" value="" placeholder="name">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forpasswordusername" class="col-sm-4 col-form-label text-right">Username/Email*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="password_username" id="password_username" value="" placeholder="username/email">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">Password*</label>
	    					<div class="col-sm-8">
	    						<input type="password" class="form-control" name="new_password_management" id="new_password_management" value="" placeholder="Password">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">URL*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="password_url" id="password_url" value="" placeholder="login url">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">Description</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="new_password_description" id="new_password_description" value="" placeholder="Description">
	    					</div>
	  					</div>
	  					<input type="hidden" name="edit_password_management_id" id="edit_password_management_id">
	        		</form>
	      		</div>
	      		<div class="modal-footer">
	        		<button type="button" class="btn btn-primary" onclick="saveNewPassword()">Save</button>
	        		<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
	      		</div>
	    	</div>
	  	</div>
	</div>

	<div class="modal fade" id="add_edit_password" tabindex="-1" aria-labelledby="add_edit_passwordLabel" aria-hidden="true">
	  	<div class="modal-dialog">
	    	<div class="modal-content">
	      		<div class="modal-header">
	        		<h5 class="modal-title" id="add_new_passwordLabel">Edit Password</h5>
	      		</div>
	      		<div class="modal-body">
	        		<form id="add_new_password_form">
	        			<div class="alert alert-secondary" id="edit_password_error" style="display:none;" role="alert"></div>
	        			<div class="alert alert-info" id="edit_password_info_msg" style="display:none;" role="alert"></div>
	        			<div class="alert alert-success" id="edit_password_success_msg" style="display:none;" role="alert"></div>
	        			<div class="form-group row">
	   						<label for="forcategory" class="col-sm-4 col-form-label text-right" >Category</label>
	    					<div class="col-sm-8">
	    						<select class="form-control" id="edit_password_category">
	    							<option value=0>Select Category</option>
	    							{% for category in password_category %}
	    								<option value='{{ category.pk}}'>{{ category.name }}</option>
	    							{% endfor %}
	    						</select>
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forpasswordname" class="col-sm-4 col-form-label text-right" >Name*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="edit_password_name" id="edit_password_name" value="" placeholder="name">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forpasswordusername" class="col-sm-4 col-form-label text-right">Username/Email*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="edit_password_username" id="edit_password_username" value="" placeholder="username/email">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">Password*</label>
	    					<div class="col-sm-8">
	    						<input type="password" class="form-control" name="edit_password_management" id="edit_password_management" value="" placeholder="Password">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">URL*</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="edit_password_url" id="edit_password_url" value="" placeholder="login url">
	    					</div>
	  					</div>
	  					<div class="form-group row">
	   						<label for="forPassword" class="col-sm-4 col-form-label text-right">Description</label>
	    					<div class="col-sm-8">
	    						<input type="text" class="form-control" name="edit_password_description" id="edit_password_description" value="" placeholder="Description">
	    					</div>
	  					</div>
	        		</form>
	      		</div>
	      		<div class="modal-footer">
	        		<button type="button" class="btn btn-success" onclick="UpdatePasswordManagement()">Update</button>
	        		<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
	      		</div>
	    	</div>
	  	</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
	<script src="{% static 'portal/js/portalnavbar.js' %}"></script>
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script type="text/javascript">
		function saveNewPassword(){
			var name = $("#password_name").val();
			var category = $("#password_category").val();
			var username =  $("#password_username").val();
			var password = $("#new_password_management").val();
			var url = $("#password_url").val();
			var description = $("#new_password_description").val();

			$("#new_password_error").empty();
			$("#new_password_error").hide();
			if(inputCheckIfNotEmpty("password_name", "Password Name", "new_password_error") != true){ return false; }
			if(inputCheckIfNotEmpty("password_username", "Username / Email", "new_password_error") != true){ return false;}
			if(inputCheckIfNotEmpty("new_password_management", "Password", "new_password_error") != true){ return false;}
			if(inputCheckIfNotEmpty("password_url", "Url", "new_password_error") != true){return false;}
			$("#new_password_info_msg").show();
			$("#new_password_info_msg").append("Process request. . .");
			dataVal = {
				"csrfmiddlewaretoken": '{{ csrf_token }}',
		        "userId": '{{ request.user.id }}',
		        "category": category,
		        "password_name":name ,
		        "username": username,
		        "password": password,
		        "url": url,
		        "description": description,
			}
			$.ajax({
		        type: "POST",
		        url: "{% url 'profileNewPassword' %}",
		        data: dataVal,
		        async:true,
		        success: function (data) {
		        	$("#new_password_info_msg").hide();
		            if(data.status == 1){
		            	$("#new_password_success_msg").show();
		            	$("#new_password_success_msg").append(data.success_msg);
		            	location.reload(true);
		            }else{
		            	$("#new_password_error").append(data.error_msg);
		            	$("#new_password_error").show();
		            }
		        },
		        error: function (e) {
		            $("#new_password_error").append("Error! please try again later.");
		        }
		    })
		}

		function UpdatePasswordManagement(){
			$("#edit_password_info_msg").empty();
			$("#edit_password_info_msg").append("Updating . . .");
			$("#edit_password_info_msg").show();
			$("#edit_password_error").hide();
			$("#edit_password_success_msg").hide();
			var password_management_id = $("#edit_password_management_id").val();
			var password_name = $("#edit_password_name").val();
			var password_username = $("#edit_password_username").val();
			var password_management_password = $("#edit_password_management").val();
			var password_url = $("#edit_password_url").val();
			var password_description = $("#edit_password_description").val();
			var password_category = $("#edit_password_category").val();
			$.ajax({
		        type: "POST",
		        url: "{% url 'ProfileUpdatePassword' %}",
		        data: {
		        	"csrfmiddlewaretoken": '{{ csrf_token }}',
		        	"password_management_id":password_management_id,
		        	"name": password_name,
		        	"username": password_username,
		        	"password":password_management_password,
		        	"url":password_url,
		        	"description":password_description,
		        	"category": password_category,
		        },
		        async:true,
		        success: function (data) {
		        	$("#edit_password_info_msg").hide();
		        	if(data.status_code == 1){
		        		$("#edit_password_success_msg").empty();
		        		$("#edit_password_success_msg").append(data.status_msg);
		        		$("#edit_password_success_msg").show();
		        		$("#edit_password_success_msg").hide(2000);
		        	}else{
		        		$("#edit_password_error").empty();
		        		$("#edit_password_error").append(data.status_msg);
		        		$("#edit_password_error").show();
		        		$("#edit_password_error").hide(2000);
		        	}
		        },
		        error: function (e) {
		        	$("#edit_password_info_msg").hide();
		            $("#edit_password_error").empty();
		    		$("#edit_password_error").append("Error on updating!");
		    		$("#edit_password_error").show();
		    		$("#edit_password_error").hide(2000);
		        }
		    })
		}

		function inputCheckIfNotEmpty(field_id, field_name, error_holder_field_name){
			var value = $("#"+field_id).val();
			if(value.length == 0){
				$("#"+field_id).focus();
				$("#"+error_holder_field_name).append(field_name+" Should not be empty!")
				$("#"+error_holder_field_name).show();
				return false;
			}else{
				return true;
			}
		}

		function editPasswordManagement(that){
			// clear form
			$("#edit_password_management_id").val(0);
			$("#edit_password_name").val("");
			$("#edit_password_username").val("");
			$("#edit_password_management").val("");
			$("#edit_password_url").val("");
			$("#edit_password_description").val("");
			$("#edit_password_category").val(0);
			var password_management_id = $(that).attr("attr_id");
			$("#edit_password_info_msg").empty();
			$("#edit_password_info_msg").append("Fetching data . . .");
			$("#edit_password_info_msg").show();
			$.ajax({
		        type: "POST",
		        url: "{% url 'ProfileNewPasswordGetById' %}",
		        data: {
		        	"csrfmiddlewaretoken": '{{ csrf_token }}',
		        	"password_management_id":password_management_id,
		        },
		        async:true,
		        success: function (data) {
		        	$("#edit_password_info_msg").hide();
		        	$("#edit_password_name").val(data.name);
		        	$("#edit_password_username").val(data.username)
		        	$("#edit_password_management").val(data.password)
		        	$("#edit_password_url").val(data.url)
		        	$("#edit_password_description").val(data.description)
		        	$("#edit_password_management_id").val(password_management_id)
		        	$("#edit_password_category").val(data.category)
		        	$("#edit_password_info_msg").hide();
		        },
		        error: function (e) {
		        	$("#edit_password_info_msg").hide();
		            $("#edit_password_error").empty();
		    		$("#edit_password_error").append("Error on Fetching!");
		    		$("#edit_password_error").show();
		        }
		    })
		}
	</script>
</body>
</html>