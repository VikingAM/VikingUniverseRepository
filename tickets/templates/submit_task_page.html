{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Task Dashboard</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'portal/css/navbar.css' %}">
	<link rel="stylesheet" href="{% static 'fontawesome/css/all.css' %}">
	<link rel="stylesheet" href="{% static 'task/css/submit_task.css' %}">
	<style type="text/css">
		.border_1{
			border: 1px solid black;
		}
		.text-right{
			text-align: right;
		}

		.text-left{
			text-align: left;
		}
		.text-pure-center{
			margin: auto;
		}
		.card-body{
			text-align: center;
			margin: auto;
		}
		.card-img-top{
			width: 120px;
		}
		.card{
			height: 100%;
		}
		.parent_category{
			font-family: 'Poppins', sans-serif;
			font-style: normal;
			font-weight: 700;
			font-size: 20px;
			line-height: 30px;
			color: #0717A3;
			margin-left: 1%;
		}
		.step-background{
			background: linear-gradient(180deg, #434CF0 0%, #C53CF0 97.92%);
			border-radius: 20px 0px 0px 20px;
		}
	</style>
</head>
<body style="background:#F5F6FA;">
<div class="row" id="body-row">
	{% include 'sidebar_v1.html' %}
	<div class="col p-4 main-container">
		<div class="row search_bar_wrapper">
			<div class="col-sm-10">
				<!-- <input class="form-control" type="text" id="portal_search_bar" name="portal_search_bar" placeholder="Search . . . "> -->
			</div>
			<div class="col-sm-2" style="text-align:right; margin: auto;">
				<i class="fas fa-fw fa-bell"></i> <span class="indicator"></span>
				<span>
					<img src="https://img.icons8.com/dusk/100/000000/user-female-circle.png" alt="" class="user-avatar-md rounded-circle" width="25px">
					{{ profile_details.first_name }} {{ profile_details.last_name }}
					<span class="dropdown">
						<span class="fa-solid fa-angle-down" type="button" id="Account-menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Account-menu">
							<a href="{% url 'portalSettingPage' %}"><button class="dropdown-item" type="button">Account</button></a>
						    <button class="dropdown-item" type="button">Settings</button>
						    <button class="dropdown-item" type="button">Logout</button>
						</div>
					</span>
				</span>
			</div>
		</div><br/>
		<div class="row">
			<div class="col-sm-12" id="ChooseService">
				CHOOSE A SERVICE
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12">
				<button class="SearchaService"><i class="fa-solid fa-magnifying-glass"></i>Search a Service</button>
			</div>
		</div><br/>
		<div class="row">
			<div class="col-sm-12">
				<span class="CategoryDropDown">
					<span class="ActiveCategory">Design and Arts</span>
					<span class="dropdown">
						<span class="fa-solid fa-angle-down" type="button" id="category-menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
						<div class="dropdown-menu dropdown-menu-left" aria-labelledby="category-menu">
							{% for category_theme in category_themes %}
								{% if forloop.counter == 1 %}
									<button class="dropdown-item caetgory" type="button" onclick="UpdateActiveCategory(this);" category_id="{{ category_theme.id  }}" category_text='{{ category_theme.name }}'>{{ category_theme.name }}</button>
								{% else %}
									<button class="dropdown-item" type="button" onclick="UpdateActiveCategory(this);" category_id="{{ category_theme.id  }}" category_text='{{ category_theme.name }}'>{{ category_theme.name }}</button>
								{% endif %}
							{% empty %}
								<button class="dropdown-item caetgory" type="button">No Category</button>
							{% endfor %}
						</div>
					</span>
				</span>
			</div>
		</div>
		<br/>
		<div class="category_wrapper">
			
		</div>
	</div>


	<!-- Modal -->
	<div class="modal fade" id="SubmitATaskModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  		<div class="modal-dialog modal-xl">
    		<div class="modal-content">
      			<div class="modal-body">
      				<div class="row">
      					<div class="col-sm-3 step-background"></div>
      					<div class="col-sm-9">
      						<div class="row">
      							<div class="col-sm-11">
      								<h3 id="SubmitTaskTitle"></h3>
      							</div>
      							<div class="col-sm-1">
      								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          								<span aria-hidden="true">&times;</span>
        							</button>
      							</div>
      						</div>
      						<div class="row">
		        				<div class="col-sm-12">
		        					<h5>Task Details</h5>
		        				</div>
		        			</div>
		        			<div class="row">
		        				<div class="col-sm-4">
		        					Select Service
		        				</div>
		        				<div class="col-sm-8">
		        					<select class="form-control" id="category_services">
		        						<option>Selected services</option>
		        					</select>
		        				</div>
		        			</div>
		        			<hr>
		        			<div class="row">
		        				<div class="col-sm-4">
		        					Task Name: 
		        				</div>
		        				<div class="col-sm-8">
		        					<input class="form-control" type="text" name="task_name" id="task_name" placeholder="Task Name">
		        				</div>
		        			</div>
		        			<br/>
		        			<div class="row">
		        				<div class="col-sm-4">
		        					Description
		        				</div>
		        				<div class="col-sm-8">
		        					<textarea class="form-control" id="task_description" name="task_description"></textarea>
		        				</div>
		        			</div>
		        			<hr>
		        			<div class="row">
		        				<div class="col-sm-4">
		        					Attachments:
		        				</div>
		        				<div class="col-sm-8">
		        					<input type="file" name="submit_task_attachment" id="submit_task_attachment">
		        				</div>
		        			</div>
		        			<br/>
		        			<div class="row">
		        				<div class="col-sm-12">
		        					Add-on Task Deals
		        				</div>
		        			</div>
		        			<br/>
		        			<div class="row">
		        				<div class="col-sm-12" style="text-align: right;">
		        				 	<button class="btn-primary" onclick="SaveTaskandContinue();">Save and Continue</button>
		        				</div>
		        			</div>
      					</div>
      				</div>
      			</div>
    		</div>
  		</div>
	</div>


	<div class="modal fade" id="LoadingMoodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  		<div class="modal-dialog">
    		<div class="modal-content">
      			<div class="modal-body">
      				<h4>fetching data. . . </h4>
      			</div>
    		</div>
  		</div>
	</div>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
<script src="{% static 'portal/js/portalnavbar.js' %}"></script>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
	$(document).ready(function(){
		getCategoryDetailsByTheme(2);
	})
	function UpdateActiveCategory(that){
		var category_chosen = $(that).attr("category_text");
		var category_theme_id = $(that).attr("category_id");
		$(".ActiveCategory").empty();
		$(".ActiveCategory").append(category_chosen);
		getCategoryDetailsByTheme(category_theme_id);
	}

	function SaveTaskandContinue(){
		var taskName = $("#task_name").val();
		var taskDescription = $("#task_description").val();
		var categoryId = $("#category_services").val();

		if(taskName.length == 0 ){
			alert("Please fill up the task name!");
			return false;
		}
		if(taskDescription.length == 0){
			alert("Please make at least short a short description of the task!");
			return false;
		}

		jQuery.noConflict();
		jQuery.ajax({
	        type: "POST",
	        url: "{% url 'createTask' %}",
	        async:true,
	        data: {
	        	"csrfmiddlewaretoken": '{{ csrf_token }}',
	        	"task_name":taskName,
	        	"task_description":taskDescription,
	        	"category_id": categoryId,
	        },
	        success: function (data) {
	        	alert("Task Created!")
				window.$("#SubmitATaskModal").modal("hide");
	        	console.log(data);
	        },
	        error: function (e) {
	        	console.log(e);
	        }
	    })
	}
	function getCategoryDetailsByTheme(CategoryThemeId){
		jQuery.noConflict();
		jQuery.ajax({
	        type: "POST",
	        url: "{% url 'getCategoryServices' %}",
	        async:true,
	        data: {
	        	"csrfmiddlewaretoken": '{{ csrf_token }}',
	        	"CategoryThemeId":CategoryThemeId,
	        },
	        success: function (data) {
	        	if(data.status_code == 1){
	        		reload_services(data.list_of_category);	
	        	}
	        },
	        error: function (e) {
	        	console.log(e);
	        }
	    })
	}

	function showCreateTaskForm(that){
		jQuery.noConflict();
		window.$("#LoadingMoodal").modal("show");
		var category_id = $(that).attr("category_id");
		jQuery.ajax({
			type: "POST",
			url: "{% url 'getCategoryDetailsById' %}",
			async:true,
			data: {
	        	"csrfmiddlewaretoken": '{{ csrf_token }}',
	        	"category_id":category_id,
	        },
	        success: function (data) {
	        	if(data.status_code == 1){
	        		showModalCategory(data);
	        	}	
	        },
	        error: function (e) {
	        	console.log(e);
	        }
		})
	}

	function showModalCategory(dataValue){
		
		window.$("#LoadingMoodal").modal("hide");
		window.$("#SubmitATaskModal").modal('show');
		jQuery("#SubmitTaskTitle").empty();
		jQuery("#SubmitTaskTitle").append(dataValue.category_theme+" / "+dataValue.category_parent_name+" / "+dataValue.category_name);
		jQuery("#category_services").empty();
		jQuery("#task_name").empty();
		jQuery("#task_description").empty();
		jQuery.each(dataValue.list_of_category, function(index,value){
			if(value.id == dataValue.category_id){
				jQuery("#category_services").append("<option value='"+value.id+"' selected>"+value.name+"</option>");
			}else{
				jQuery("#category_services").append("<option value='"+value.id+"'>"+value.name+"</option>");	
			}
			
		});
	   
	}
	
	function reload_services(listOfCategory){
		jQuery(".category_wrapper").empty();
		jQuery.each(listOfCategory, function(index, value){
			if(value.parent == 0){
				jQuery(".category_wrapper").append("<br/><div class='row'> <div class='col-sm-12 parent_category'>"+value.name+"</div></div>");
				var childCounter = 0;
				jQuery.each(listOfCategory, function(index2, value2){
					if(value2.parent == value.id){
						childCounter++;
					}
				})
				if(childCounter > 4){
					var listofcategoryCard = "";
					var loopCounter = 0;
					jQuery.each(listOfCategory, function(index2,value2){
						if(value2.parent == value.id){
							if(loopCounter > 3){
								listofcategoryCard += "<div class='col-sm-3' style='display:none;'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";
							}else{
								listofcategoryCard += "<div class='col-sm-3'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";	
							}
							loopCounter++;
						}
					})

					var output = "<div class='row'><div class='col-sm-1 text-right text-pure-center' style='color: #BCBABA; font-size: 40px; cursor: pointer;'>";
					output += "<i class='fa-solid fa-chevron-left'></i>";
					output += "</div>";
					output += "<div class='col-sm-10'>";
					output += 	"<div class='row'>";
					output += listofcategoryCard
					output += 	"</div>"
					output += "</div>"
					output += "<div class='col-sm-1 text-left text-pure-center' style='color: #BCBABA; font-size: 40px; cursor:pointer;'>"
					output += 	"<i class='fa-solid fa-chevron-right'></i>"
					output += "</div></div>";
					jQuery(".category_wrapper").append(output);
					
					
				}else{
					if(childCounter == 1){
						var listofcategoryCard = "";
						jQuery.each(listOfCategory, function(index2,value2){
							if(value2.parent == value.id){
								listofcategoryCard += "<div class='col-sm-3'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";	
							}
						})
						jQuery(".category_wrapper").append("<div class='row'><div class='col-sm-4'></div> "+listofcategoryCard+" <div class='col-sm-5'></div></div>");
					}else if(childCounter == 2){
						var listofcategoryCard = "";
						jQuery.each(listOfCategory, function(index2,value2){
							if(value2.parent == value.id){
								listofcategoryCard += "<div class='col-sm-3'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";	
							}
						})
						jQuery(".category_wrapper").append("<div class='row'><div class='col-sm-3'></div>"+listofcategoryCard+"<div class='col-sm-3'></div></div>");
					}else if(childCounter == 3){
						var listofcategoryCard = "";
						jQuery.each(listOfCategory, function(index2,value2){
							if(value2.parent == value.id){
								listofcategoryCard += "<div class='col-sm-3'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";	
							}
						})
						jQuery(".category_wrapper").append("<div class='row'><div class='col-sm-1'></div> "+listofcategoryCard+"<div class='col-sm-2'></div>");
					}else{
						var listofcategoryCard = "";
						jQuery.each(listOfCategory, function(index2,value2){
							if(value2.parent == value.id){
								listofcategoryCard += "<div class='col-sm-3'><div class='card' style='cursor:pointer;' category_id='"+value2.id+"' onclick='showCreateTaskForm(this);'><div class='card-body'><h5 class='card-title'>"+ value2.name +"</h5><img src='/static/images/Services.png' class='card-img-top' alt='...'><p class='card-text'><small class='text-muted'>Business Card & Stationery Design Service Description</small></p></div></div></div>";	
							}
						})
						jQuery(".category_wrapper").append("<div class='row'> "+listofcategoryCard+"</div>");
					}
				}
			}
		})
	}

</script>
</body>
</html>