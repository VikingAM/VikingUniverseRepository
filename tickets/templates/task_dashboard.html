{% load static %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Task Dashboard</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@1,700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'portal/css/navbar.css' %}">
	<link rel="stylesheet" href="{% static 'fontawesome/css/all.css' %}">
	<link rel="stylesheet" href="{% static 'task/css/task_dashboard.css' %}">

</head>
<body style="background:#F5F6FA;">
<div class="row" id="body-row">
	{% include 'sidebar_v1.html' %}
	<div class="col p-4 main-container">
		<div class="row search_bar_wrapper">
			<div class="col-sm-10">
				<!-- <input class="form-control" type="text" id="portal_search_bar" name="portal_search_bar" placeholder="Search . . . "> -->
			</div>
			<div class="col-sm-2" style="text-align:right; margin: auto;">
				<i class="fas fa-fw fa-bell"></i> <span class="indicator"></span>
				<span>
					<img src="https://img.icons8.com/dusk/100/000000/user-female-circle.png" alt="" class="user-avatar-md rounded-circle" width="25px">
					{{ profile_details.first_name }} {{ profile_details.last_name }}
					<span class="dropdown">
						<span class="fa-solid fa-angle-down" type="button" id="Account-menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="Account-menu">
							<button class="dropdown-item" type="button">Account</button>
						    <button class="dropdown-item" type="button">Settings</button>
						    <button class="dropdown-item" type="button">Logout</button>
						</div>
					</span>
				</span>
			</div>
		</div><br/>
		<div class="row">
			<div class="col-sm-12">
				<span class="task_dashboard_header_Text">Your Task</span>
			</div>
			<div class="col-sm-12">
				<span class="task_dashboard_filter">Filter By 
					<span class="filter_status">Open Task</span>
					<span class="dropdown">
						<span class="fa-solid fa-arrow-down-wide-short" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
						<div class="dropdown-menu" aria-labelledby="dropdownMenu2">
							<button class="dropdown-item" type="button" attr_val="Open Task" onclick="SelectFilter(this);">Open</button>
						    <button class="dropdown-item" type="button" attr_val="In Progress" onclick="SelectFilter(this);">In Progress</button>
						    <button class="dropdown-item" type="button" attr_val="For Approval" onclick="SelectFilter(this);">For Approval</button>
						    <button class="dropdown-item" type="button" attr_val="Completed" onclick="SelectFilter(this);">Completed</button>
						</div>
					</span>
				</span>
			</div>
		</div>
		<div class="row" id="ticket_wrapper">
			{% for ticket in open_tickets %}
				<div class="col-sm-12" ticket_id="{{ ticket.pk }}" style="cursor:pointer;" onclick="viewTicketDetails(this);">
					<div class="card" style="width:98%; border-radius: 15px;">
					  	<div class="card-body">
						    <span class="card-title task_title">{{ ticket.title}}</span> 
						    <span class="badge badge-pill" style="background: #87DEC9; color: #387C6C;">{{ ticket.category.name}}</span>
						    <!-- <span class="badge badge-pill" style="background: #D3D7FE; color: #4454DE;">Category</span>
						    <span class="badge badge-pill" style="background: #FEEAD3; color: #EF9D3E;">Category</span> -->
						    <div class="row">
						    	<div class="col-sm-2">
						    		<span class="task_create_date">
								    	<i class="fa-regular fa-calendar-days"></i>{{ ticket.create_date |date:"M d, Y" }}
								    </span>
								    
						    	</div>
						    	<div class="col-sm-2" style="margin:auto;">
						    		<div class="progress">
											<div class="progress-bar" role="progressbar" style="width: 0%; text-align: center; background: #BEA4EC;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">0%</div>
									</div>
						    	</div>
						    	<div class="col-sm-8"></div>
						    </div>
						    <p class="card-text task_card_description">{{ ticket.description }}</p>
					  	</div>
					</div>
				</div>
			{% empty %}

			{% endfor %}
		</div>
	</div>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
<script src="{% static 'portal/js/portalnavbar.js' %}"></script>
<script>
	$(document).ready(function(){
		
	})

	function SelectFilter(that){
		var filter_value = $(that).attr("attr_val");
		if(filter_value == "For Approval"){
			grabAllTicketByFilter("Pending");
		}else if(filter_value == "Open"){
			grabAllTicketByFilter("Open");
		}else if(filter_value == "Completed"){
			grabAllTicketByFilter("Complete");
		}else if(filter_value == "In Progress"){
			grabAllTicketByFilter("In Progress");
		}
		$(".filter_status").empty();
		$(".filter_status").append(filter_value);
	}

	function grabAllTicketByFilter(Filter="Open"){
		$("#ticket_wrapper").empty();
		$.ajax({
	        type: "POST",
	        url: "{% url 'getTciketByFilter' %}",
	        data: {
	        	"csrfmiddlewaretoken": '{{ csrf_token }}',
	        	"filter":Filter,
	        },
	        async:true,
	        success: function (data) {
	        	formatListOfTickets(data);
	        	
	        },
	        error: function (e) {
	            // $("#new_password_error").append("Error! please try again later.");
	        }
	    })
	}

	function formatListOfTickets(dataValue){
		var output ="";
		var list_of_task = dataValue.list_of_task;
		if(Object.keys(list_of_task).length > 0){
			$.each(list_of_task, function(index, value){
				output += "<div class='col-sm-12' ticket_id='"+value.id+"' style='cursor:pointer;' onclick='viewTicketDetails(this);'>";
				output += "<div class='card' style='width:98%; border-radius: 15px;'>";
				output += "<div class='card-body'>";

				output += "<span class='card-title task_title'>"+value.name+"</span>";
				output += "<span class='badge badge-pill' style='background: #87DEC9; color: #387C6C;'>"+value.caetgory_name+"</span>";

				output += "<div class='row'>";

				output += "<div class='col-sm-2'>";
				output += "	<span class='task_create_date'><i class='fa-regular fa-calendar-days'></i>"+value.create_date+"</span>";
				output += "</div>";
				
				output += "<div class='col-sm-2' style='margin:auto;'>";
				output += "	<div class='progress'>";
				output += "		<div class='progress-bar' role='progressbar' style='width: "+value.task_percentage+"%; text-align: center; background: #BEA4EC;' aria-valuenow='25' aria-valuemin='0' aria-valuemax='100'>"+value.task_percentage+"%</div>";
				output += "	</div>";
				output += "</div>";
				output += "<div class='col-sm-8'></div>";
				output += "</div>";

				output += "<p class='card-text task_card_description'>"+value.description+"</p>";

				output += "</div>";
				output += "</div>";
				output += "</div>";		
			});

			$("#ticket_wrapper").empty();
			$("#ticket_wrapper").append(output);
		}else{
			$("#ticket_wrapper").empty();
		}


		
	}

	function viewTicketDetails(that){

	}
</script>
</body>
</html>